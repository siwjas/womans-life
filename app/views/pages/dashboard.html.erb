<div class="bg-gray-50 dark:bg-gray-900 min-h-screen py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Seu Dashboard Personalizado</h1>
      <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">Acompanhe sua saúde e bem-estar</p>
    </div>

    <!-- Próximos Eventos -->
    <section class="mb-10">
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Próximos Eventos</h2>
      
      <div class="flex flex-col md:flex-row gap-4">
        <% if @upcoming_events.present? %>
          <% @upcoming_events.each_with_index do |event, index| %>
            <!-- Adicionar log para depuração -->
            <% if Rails.env.development? %>
              <% puts "Rendering event #{index}: #{event[:type]}" %>
            <% end %>
            
            <% if event[:type] == 'weight' %>
              <div class="flex-1 w-full">
                <div class="flex flex-col gap-4">

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border-l-4 
                            <%= event[:status] == 'ideal' ? 'border-green-500' : 
                              event[:status] == 'lose' ? 'border-rose-500' : 
                              'border-green-500' %>">
                  <div class="p-5">
                    <div class="flex justify-between items-start">
                      <div>
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white"><%= event[:name] %></h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                          Peso atual: <%= event[:current] %> kg
                        </p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                          Peso ideal: <%= event[:target] %> kg
                        </p>
                      </div>
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                  <%= event[:status] == 'ideal' ? 'bg-green-100 text-green-800' :
                                    event[:status] == 'lose' ? 'bg-rose-100 text-rose-800' :
                                    'bg-blue-100 text-blue-800' %>">
                        <%= event[:message] %>
                      </span>
                    </div>
                    
                    <% if event[:status] == 'ideal' %>
                      <!-- Mensagem de peso ideal com ícone de check -->
                      <div class="mt-3 flex items-center justify-center py-2 text-green-600">
                        <svg class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span class="text-sm font-medium">Você está no seu peso ideal!</span>
                      </div>
                    <% else %>
                      <!-- Barra de progresso para quem precisa ganhar ou perder peso -->
                      <div class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                          <% 
                            # Calcular a porcentagem do progresso
                            if event[:status] == 'lose'
                              # Se precisa perder peso, quanto mais próximo do ideal, maior o progresso
                              max_weight = event[:current] * 1.3  # 30% acima do peso atual como referência máxima
                              progress = ((max_weight - event[:current]) / (max_weight - event[:target]) * 100).round
                              progress = [progress, 100].min
                              progress_color = "bg-rose-500"
                            else
                              # Se precisa ganhar peso, quanto mais próximo do ideal, maior o progresso
                              min_weight = event[:current] * 0.7  # 30% abaixo do peso atual como referência mínima
                              progress = ((event[:current] - min_weight) / (event[:target] - min_weight) * 100).round
                              progress = [progress, 100].min
                              progress_color = "bg-green-500"
                            end
                          %>
                          <div class="<%= progress_color %> h-2.5 rounded-full" style="width: <%= progress %>%"></div>
                        </div>
                      </div>
                    <% end %>
                    
                    <div class="mt-2 text-right">
                      <%= link_to "Ver detalhes", bmi_calculators_path, class: "text-sm text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" %>
                    </div>
                  </div>
                </div>

                <!-- Tabela de histórico -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                  <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-3">Últimas pesagens</h3>
                  <div class="overflow-y-auto max-h-64">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                      <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                          <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                          <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">IMC</th>
                          <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Peso</th>
                          <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Categoria</th>
                        </tr>
                      </thead>
                      <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        <% @bmi_history.reverse.each_with_index do |bmi, index| %>
                          <tr>
                            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                              <%= bmi.created_at.strftime("%d/%m/%Y") %>
                            </td>
                            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                              <%= bmi.bmi %>
                              <% if index < @bmi_history.size - 1 %>
                                <% diff = bmi.bmi - @bmi_history.reverse[index + 1].bmi %>
                                <% if diff > 0 %>
                                  <span class="text-rose-500 text-xs ml-1">↑</span>
                                <% elsif diff < 0 %>
                                  <span class="text-green-500 text-xs ml-1">↓</span>
                                <% end %>
                              <% end %>
                            </td>
                            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                              <%= bmi.weight %> kg
                            </td>
                            <td class="px-3 py-2 whitespace-nowrap text-sm">
                              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                          <%= bmi.bmi < 18.5 ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300' :
                                            bmi.bmi < 25 ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' :
                                            bmi.bmi < 30 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300' :
                                            'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300' %>">
                                <%= bmi.bmi_category %>
                              </span>
                            </td>
                          </tr>
                        <% end %>
                      </tbody>
                    </table>
                  </div>
                  <div class="mt-4 text-right">
                    <%= link_to "Adicionar nova pesagem", bmi_calculators_path, 
                        class: "text-sm text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" %>
                  </div>
                </div>
              </div>
              </div>

            <% elsif event[:type] == 'period' && @latest_menstrual %>
              <div class="flex-1 w-full bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border-l-4 border-pink-500">
                <div class="p-5">
                  <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Próximo Ciclo Menstrual</h3>
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-pink-100 text-pink-800">
                      Em <%= event[:days_away] %> dias
                    </span>
                  </div>
                  
                  <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    Data prevista: <%= event[:date].strftime("%d/%m/%Y") %>
                  </p>
                  
                  <!-- Calendário simplificado em vez do mini-calendário -->
                  <%= render 'shared/simple_calendar', date: event[:date], bg_color: 'bg-pink-50' do |date| %>
                    <% is_period_day = (date >= event[:date] && date <= event[:date] + 5.days) %>
                    <% is_period_day ? 'bg-pink-500 text-white' : '' %>
                  <% end %>
                </div>
              </div>
            <% elsif event[:type] == 'fertility' && @latest_menstrual %>
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border-l-4 border-green-500">
                <div class="p-5">
                  <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Período Fértil</h3>
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                      Em <%= event[:days_away] %> dias
                    </span>
                  </div>
                  
                  <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    De <%= event[:date].strftime("%d/%m/%Y") %> até <%= event[:end_date].strftime("%d/%m/%Y") %>
                  </p>
                  
                  <!-- Calendário simplificado em vez do mini-calendário -->
                  <%= render 'shared/simple_calendar', date: event[:date], bg_color: 'bg-green-50' do |date| %>
                    <% is_fertile_day = (date >= event[:date] && date <= event[:end_date]) %>
                    <% is_ovulation_day = (date == event[:date] + 3.days) %>
                    <% 
                      if is_ovulation_day
                        'bg-green-500 text-white'
                      elsif is_fertile_day
                        'bg-green-200 text-green-800'
                      else
                        ''
                      end
                    %>
                  <% end %>
                </div>
              </div>
            <% else %>
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border-l-4 
                          <%= event[:type] == 'menstrual' ? 'border-pink-500' : 
                             event[:type] == 'fertility' ? 'border-purple-500' : 'border-blue-500' %>">
                <div class="p-5">
                  <div class="flex justify-between items-start">
                    <div>
                      <h3 class="text-lg font-semibold text-gray-800 dark:text-white"><%= event[:name] %></h3>
                      <p class="text-sm text-gray-600 dark:text-gray-300">
                        <%= event[:date].strftime("%d/%m/%Y") %>
                        <% if event[:end_date].present? %>
                          até <%= event[:end_date].strftime("%d/%m/%Y") %>
                        <% end %>
                      </p>
                    </div>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                <%= event[:status] == 'current' ? 'bg-purple-100 text-purple-800' :
                                   event[:days_away] < 0 ? 'bg-gray-100 text-gray-800' :
                                   event[:days_away] == 0 ? 'bg-red-100 text-red-800' :
                                   event[:days_away] <= 3 ? 'bg-red-100 text-red-800' :
                                   event[:days_away] <= 7 ? 'bg-yellow-100 text-yellow-800' :
                                   'bg-green-100 text-green-800' %>">
                      <% if event[:status] == 'current' %>
                        Acontecendo agora
                      <% elsif event[:days_away] < 0 %>
                        Passou
                      <% elsif event[:days_away] == 0 %>
                        Hoje
                      <% else %>
                        Em <%= event[:days_away] %> dias
                      <% end %>
                    </span>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <div class="col-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center">
            <p class="text-gray-600 dark:text-gray-300">
              Nenhum evento próximo. Use nossas calculadoras para acompanhar seu ciclo e saúde.
            </p>
            <div class="mt-4">
              <%= link_to "Calculadoras", "#", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500" %>
            </div>
          </div>
        <% end %>
      </div>
    </section>

    <!-- Calendário Menstrual -->
    <% if @latest_menstrual %>
      <section class="mb-10">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Seu Ciclo Menstrual</h2>
        
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Informações do ciclo -->
            <div>
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Informações do Ciclo</h3>
              
              <div class="space-y-4">
                <div class="flex justify-between items-center border-b pb-2 dark:border-gray-700">
                  <span class="text-gray-700 dark:text-gray-300">Último ciclo:</span>
                  <span class="font-medium text-gray-900 dark:text-white"><%= l(@latest_menstrual.last_period_date, format: :long) %></span>
                </div>
                
                <div class="flex justify-between items-center border-b pb-2 dark:border-gray-700">
                  <span class="text-gray-700 dark:text-gray-300">Próximo ciclo:</span>
                  <span class="font-medium text-gray-900 dark:text-white"><%= l(@latest_menstrual.next_period_date, format: :long) %></span>
                </div>
                
                <div class="flex justify-between items-center border-b pb-2 dark:border-gray-700">
                  <span class="text-gray-700 dark:text-gray-300">Duração do ciclo:</span>
                  <span class="font-medium text-gray-900 dark:text-white"><%= @latest_menstrual.cycle_length %> dias</span>
                </div>
                
                <div class="flex justify-between items-center border-b pb-2 dark:border-gray-700">
                  <span class="text-gray-700 dark:text-gray-300">Período fértil:</span>
                  <span class="font-medium text-gray-900 dark:text-white">
                    <%= l(@latest_menstrual.fertility_window_start, format: :short) %> até 
                    <%= l(@latest_menstrual.fertility_window_end, format: :short) %>
                  </span>
                </div>
                
                <div class="flex justify-between items-center border-b pb-2 dark:border-gray-700">
                  <span class="text-gray-700 dark:text-gray-300">Ovulação:</span>
                  <span class="font-medium text-gray-900 dark:text-white"><%= l(@latest_menstrual.ovulation_date, format: :long) %></span>
                </div>
              </div>
              
              <div class="mt-6">
                <%= link_to "Atualizar Ciclo", menstrual_cycle_calculators_path, class: "inline-flex items-center px-4 py-2 bg-pink-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-pink-700 active:bg-pink-800 focus:outline-none focus:border-pink-800 focus:ring ring-pink-300 disabled:opacity-25 transition ease-in-out duration-150" %>
              </div>
            </div>
            
            <!-- Calendário -->
            <div>
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Visualização do Ciclo</h3>
              
              <!-- Calendário simplificado para o ciclo menstrual -->
              <%= render 'shared/simple_calendar', date: @latest_menstrual.next_period_date, bg_color: 'bg-pink-50' do |date| %>
                <% 
                  # Verificar se é um dia de período menstrual
                  is_last_period = (date >= @latest_menstrual.last_period_date && 
                                    date <= @latest_menstrual.last_period_date + @latest_menstrual.period_duration.days)
                  
                  is_next_period = (date >= @latest_menstrual.next_period_date && 
                                    date <= @latest_menstrual.next_period_date + @latest_menstrual.period_duration.days)
                  
                  # Verificar se é um dia fértil
                  is_fertile = (date >= @latest_menstrual.fertility_window_start && 
                                date <= @latest_menstrual.fertility_window_end)
                  
                  # Verificar se é o dia da ovulação
                  is_ovulation = (date == @latest_menstrual.ovulation_date)
                  
                  if is_last_period
                    'bg-pink-300 text-pink-800'
                  elsif is_next_period
                    'bg-pink-500 text-white'
                  elsif is_ovulation
                    'bg-green-500 text-white'
                  elsif is_fertile
                    'bg-green-200 text-green-800'
                  else
                    ''
                  end
                %>
              <% end %>
              
              <!-- Legenda -->
              <div class="mt-4 flex flex-wrap gap-4">
                <div class="flex items-center">
                  <div class="w-4 h-4 rounded-full bg-pink-300 mr-2"></div>
                  <span class="text-sm text-gray-700 dark:text-gray-300">Último Ciclo</span>
                </div>
                <div class="flex items-center">
                  <div class="w-4 h-4 rounded-full bg-pink-500 mr-2"></div>
                  <span class="text-sm text-gray-700 dark:text-gray-300">Próximo Ciclo</span>
                </div>
                <div class="flex items-center">
                  <div class="w-4 h-4 rounded-full bg-green-200 mr-2"></div>
                  <span class="text-sm text-gray-700 dark:text-gray-300">Período Fértil</span>
                </div>
                <div class="flex items-center">
                  <div class="w-4 h-4 rounded-full bg-green-500 mr-2"></div>
                  <span class="text-sm text-gray-700 dark:text-gray-300">Ovulação</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    <% end %>

    <!-- Seção de Gráficos com Toggle -->
    <section id="charts-section" class="mb-10" data-controller="chart-toggle">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Seu Histórico de Saúde</h2>
          
          <!-- Botões de Toggle -->
          <div class="flex space-x-2">
            <button data-chart-toggle-target="weightButton" data-action="click->chart-toggle#showWeightChart" 
                  class="px-2 py-1 bg-gray-200 font-semibold text-xs text-white outline-none rounded-md hover:text-white active:bg-pink-500 hover:bg-pink-400 focus:bg-pink-400 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2">
              Peso
            </button>
            <button data-chart-toggle-target="bmiButton" data-action="click->chart-toggle#showBmiChart" 
                    class="px-2 py-1 bg-gray-200 font-semibold text-xs text-white outline-none rounded-md hover:text-white active:bg-[#7400b8] hover:bg-[#c77dff] focus:bg-[#c77dff] focus:outline-none focus:ring-2 focus:ring-[#7400b8] focus:ring-offset-2">
              IMC
            </button>
          </div>
        </div>
        
        <!-- Container dos Gráficos -->
        <div class="relative">
          <!-- Gráfico de Peso -->
          <div data-chart-toggle-target="weightChart" class="h-80">
            <%= line_chart @weight_data.pluck(:created_at, :weight), download: true, 
                points: true,
                curve: true,
                colors: ["#10B981"],
                min: (@weight_data.minimum(:weight).to_i - 7),
                max: (@weight_data.maximum(:weight).to_i + 10),
                library: {
                  chart: {
                    type: 'spline',
                    zoomType: 'xy'
                  },
                  title: {
                    text: 'Histórico de Peso (kg)',
                  },
                  xAxis: {
                    type: 'datetime',
                    title: {
                      text: 'Data da pesagem'
                    },
                    labels: {
                      rotation: -45,
                      style: {
                        fontSize: '12px'
                      }
                    },
                    tickInterval: 24 * 3600 * 1000 # Um dia
                  },
                  yAxis: {
                    title: {
                      text: 'Peso (kg)',
                      style: {
                        fontWeight: 'bold',
                        color: '#ff6700',
                        fontSize: '20px'
                      }
                    },
                    min: ((@underweight_threshold.to_i) - 2),
                    max: ((@obesity_threshold.to_i) + 2),
                    tickInterval: 1, # Incremento de 1 em 1
                    gridLineWidth: 1,
                    plotLines: [
                      {
                        value: @ideal_weight_min.to_i,
                        color: '#ff9f1c',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: "Peso ideal: ( mínimo #{ @ideal_weight_min.to_i }kg )",
                          align: 'left',
                          style: {
                            color: '#004e98',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 3
                      },
                      {
                        value: @ideal_weight_max.to_i,
                        color: '#8ac926',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: "Peso ideal: ( máximo #{ @ideal_weight_max.to_i }kg )",
                          align: 'left',
                          style: {
                            color: '#004e98',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 5
                      },
                      {
                        value: @obesity_threshold.to_i,
                        color: '#EF4444',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: "Obesidade ( #{ @obesity_threshold.to_i }kg )",
                          align: 'left',
                          style: {
                            color: '#EF4444',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 5
                      }
                    ]
                  },
                  tooltip: {
                    headerFormat: '<b>{point.x:%d/%m/%Y}</b><br>',
                    pointFormat: 'Peso: {point.y:.1f} kg'
                  },
                  plotOptions: {
                    spline: {
                      marker: {
                        enabled: true
                      },
                      lineWidth: 3
                    }
                  }
                } %>
          </div>
          
          <!-- Gráfico de IMC -->
          <div data-chart-toggle-target="bmiChart" class="h-80 hidden">
            <%= line_chart @bmi_data.pluck(:created_at, :bmi), 
                points: true,
                curve: true,
                colors: ["#3B82F6"],
                min: (@bmi_data.minimum(:bmi).to_i - 3),
                max: (@bmi_data.maximum(:bmi).to_i + 5),
                library: {
                  chart: {
                    type: 'spline',
                    zoomType: 'xy'
                  },
                  title: {
                    text: 'Índice de Massa Corporal'
                  },
                  xAxis: {
                    type: 'datetime',
                    title: {
                      text: 'Data do cálculo do IMC'
                    },
                    labels: {
                      rotation: -45,
                      style: {
                        fontSize: '12px'
                      }
                    },
                    tickInterval: 24 * 3600 * 1000 # Um dia
                  },
                  yAxis: {
                    title: {
                      text: 'IMC',
                      style: {
                        fontWeight: 'bold',
                        color: '#5a189a',
                        fontSize: '20px'
                      }
                    },
                    min: (@bmi_data.minimum(:bmi).to_i - 3),
                    max: (@bmi_data.maximum(:bmi).to_i + 5),
                    tickInterval: 1, # Incremento de 1 em 1
                    gridLineWidth: 1,
                    plotLines: [
                      {
                        value: 18.5,
                        color: '#3B82F6',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: 'Limite inferior do IMC ideal: (18.5)',
                          align: 'left',
                          style: {
                            color: '#3B82F6',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 3
                      },
                      {
                        value: 25,
                        color: '#F59E0B',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: 'Limite superior do IMC ideal: (25)',
                          align: 'left',
                          style: {
                            color: '#F59E0B',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 3
                      },
                      {
                        value: 30,
                        color: '#EF4444',
                        dashStyle: 'shortdash',
                        width: 2,
                        label: {
                          text: 'Obesidade: (IMC = 30)',
                          align: 'left',
                          style: {
                            color: '#EF4444',
                            fontWeight: 'bold'
                          }
                        },
                        zIndex: 3
                      }
                    ]
                  },
                  tooltip: {
                    headerFormat: '<b>{point.x:%d/%m/%Y}</b><br>',
                    pointFormat: 'IMC: {point.y:.1f}'
                  },
                  plotOptions: {
                    spline: {
                      marker: {
                        enabled: true
                      },
                      lineWidth: 3
                    }
                  }
                } %>
          </div>
        </div>
      </div>
    </section>

    <!-- Resumo das Calculadoras -->
    <section class="mb-10">
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Seus Cálculos Recentes</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Calculadora de Gravidez -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
          <div class="bg-blue-50 dark:bg-blue-900/20 px-4 py-3 border-b border-blue-100 dark:border-blue-800">
            <h3 class="text-lg font-medium text-blue-800 dark:text-blue-300">Gravidez</h3>
          </div>
          <div class="p-4">
            <% if @latest_pregnancy %>
              <div class="space-y-3">
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Idade Gestacional:</span> 
                  <%= @latest_pregnancy.weeks %> semanas e <%= @latest_pregnancy.days %> dias
                </p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Trimestre:</span> <%= @latest_pregnancy.current_trimester %>º
                </p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Data Prevista do Parto:</span> 
                  <%= @latest_pregnancy.due_date.strftime("%d/%m/%Y") %>
                </p>
                <div class="pt-2">
                  <%= link_to "Ver detalhes", pregnancy_calculators_path, class: "text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" %>
                </div>
              </div>
            <% else %>
              <div class="text-center py-4">
                <p class="text-gray-500 dark:text-gray-400 mb-3">Nenhum cálculo de gravidez encontrado</p>
                <%= link_to "Calcular agora", pregnancy_calculators_path, class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Calculadora de Ciclo Menstrual -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
          <div class="bg-pink-50 dark:bg-pink-900/20 px-4 py-3 border-b border-pink-100 dark:border-pink-800">
            <h3 class="text-lg font-medium text-pink-800 dark:text-pink-300">Ciclo Menstrual</h3>
          
          </div>
          <div class="p-4">
            <% if @latest_menstrual %>
              <div class="space-y-3">
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Próximo Ciclo:</span> 
                  <%= @latest_menstrual.next_period_date.strftime("%d/%m/%Y") %>
                </p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Janela Fértil:</span> 
                  <%= @latest_menstrual.fertility_window_start.strftime("%d/%m/%Y") %> a 
                  <%= @latest_menstrual.fertility_window_end.strftime("%d/%m/%Y") %>
                </p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Ovulação:</span> 
                  <%= @latest_menstrual.ovulation_date.strftime("%d/%m/%Y") %>
                </p>
                <div class="pt-2">
                  <%= link_to "Ver detalhes", menstrual_cycle_calculators_path, class: "text-sm text-pink-600 hover:text-pink-800 dark:text-pink-400 dark:hover:text-pink-300" %>
                </div>
              </div>
            <% else %>
              <div class="text-center py-4">
                <p class="text-gray-500 dark:text-gray-400 mb-3">Nenhum cálculo de ciclo menstrual encontrado</p>
                <%= link_to "Calcular agora", menstrual_cycle_calculators_path, class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500" %>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Calculadora de IMC -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
          <div class="bg-green-50 dark:bg-green-900/20 px-4 py-3 border-b border-green-100 dark:border-green-800">
            <h3 class="text-lg font-medium text-green-800 dark:text-green-300">IMC</h3>
          </div>
          <div class="p-4">
            <% if @latest_bmi %>
              <div class="space-y-3">
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">IMC:</span> <%= @latest_bmi.bmi %>
                </p>
                <p class="text-sm <%= @latest_bmi.bmi_text_color(@latest_bmi.bmi) %>">
                  <span class="font-medium">Classificação:</span> <%= @latest_bmi.bmi_category %>
                </p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                  <span class="font-medium">Peso:</span> <%= @latest_bmi.weight %> kg
                </p>
                <div class="pt-2">
                  <%= link_to "Ver detalhes", bmi_calculators_path, class: "text-sm text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" %>
                </div>
              </div>
            <% else %>
              <div class="text-center py-4">
                <p class="text-gray-500 dark:text-gray-400 mb-3">Nenhum cálculo de IMC encontrado</p>
                <%= link_to "Calcular agora", bmi_calculators_path, class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </section>

    <!-- Dicas Personalizadas -->
    <section>
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Dicas Personalizadas</h2>
      
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <% if @latest_bmi || @latest_menstrual || @latest_pregnancy %>
          <div class="space-y-4">
            <% if @latest_bmi %>
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">Saúde e Peso</h3>
                  <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                    <% case @latest_bmi.bmi_category %>
                    <% when "Abaixo do peso" %>
                      Seu IMC indica que você está abaixo do peso ideal. 
                      Considere consultar um nutricionista para desenvolver um plano alimentar adequado.
                    <% when "Peso ideal" %>
                      Parabéns! Seu IMC está na faixa considerada saudável. Continue mantendo hábitos saudáveis.
                    <% when "Sobrepeso" %>
                      Seu IMC indica sobrepeso. Considere aumentar a atividade física e revisar sua alimentação.
                    <% when "Obesidade Grau I" %>
                      Seu IMC indica obesidade grau I. Recomendamos consultar um profissional de saúde para orientações.
                    <% else %>
                      Seu IMC indica que você deve procurar orientação médica para melhorar sua saúde.
                    <% end %>
                  </p>
                </div>
              </div>
            <% end %>
            
            <% if @latest_menstrual %>
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <svg class="h-6 w-6 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">Ciclo Menstrual</h3>
                  <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                    <% days_to_next = (@latest_menstrual.next_period_date - Date.today).to_i %>
                    <% if days_to_next <= 3 && days_to_next >= 0 %>
                      Seu próximo ciclo menstrual está previsto para começar em breve. Prepare-se com antecedência.
                    <% elsif days_to_next < 0 %>
                      Seu ciclo menstrual estava previsto para começar há <%= days_to_next.abs %> dias. Se ainda não começou, considere atualizar seus dados.
                    <% else %>
                      Seu próximo ciclo menstrual está previsto para daqui a <%= days_to_next %> dias.
                    <% end %>
                  </p>
                </div>
              </div>
            <% end %>
            
            <% if @latest_pregnancy %>
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <svg class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">Gravidez</h3>
                  <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
                    <% case @latest_pregnancy.current_trimester %>
                    <% when 1 %>
                      Você está no primeiro trimestre. É importante tomar ácido fólico e fazer o pré-natal regularmente.
                    <% when 2 %>
                      Você está no segundo trimestre. Este é geralmente o período mais confortável da gravidez. Continue com as consultas de pré-natal.
                    <% when 3 %>
                      Você está no terceiro trimestre. Prepare-se para a chegada do bebê e continue com as consultas de pré-natal.
                    <% end %>
                  </p>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-4">
            <p class="text-gray-500 dark:text-gray-400">
              Use nossas calculadoras para receber dicas personalizadas sobre sua saúde.
            </p>
          </div>
        <% end %>
      </div>
    </section>
  </div>
</div> 